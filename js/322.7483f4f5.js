"use strict";(self["webpackChunkv3"]=self["webpackChunkv3"]||[]).push([[322],{7688:function(t,e,r){r.d(e,{J:function(){return l},Z:function(){return s}});r(560);class s{constructor(t={}){this.setData(t),this.startTimer()}setData(t){this.date=void 0!==t.date?t.date&&isNaN(t.date)?new Date(t.date).getTime():t.date:this.date,this.utc=void 0!==t.utc?t.utc:this.utc,this.onUpdate=void 0!==t.onUpdate?t.onUpdate:this.onUpdate||function(){},this.onZero=void 0!==t.onZero?t.onZero:function(){}||function(){},this.interval=void 0!==t.interval?t.interval:this.interval||1e3}startTimer(){this.date?this.countDown():this.clock(),this.w=setTimeout((()=>{this.onUpdate&&(this.date?this.t=setInterval((()=>this.countDown()),this.interval):this.t=setInterval((()=>this.clock()),this.interval))}),1e3-(new Date).getMilliseconds())}countDown(){var t=(this.date-Date.now())/1e3,e=[86400,3600,60,1].map((e=>{var r=Math.max(Math.floor(t/e),0);return t-=e*r,r}));this.onUpdate(e,t),this.date-Date.now()<=0&&this.onZero()}padNumber(t){return t<10?"0"+t:t}clock(){var t=new Date,e=this.utc?t.getUTCHours():t.getHours(),r=this.padNumber(this.utc?t.getUTCMinutes():t.getMinutes()),s=this.padNumber(this.utc?t.getUTCSeconds():t.getSeconds());this.onUpdate([e,r,s],e+":"+r+":"+s)}$update(t,e){e&&(clearInterval(this.t),clearTimeout(this.w)),this.setData(t),e&&this.startTimer()}$destroy(){clearInterval(this.t),clearTimeout(this.w),this.t=null,this.w=null,this.interval=null,this.onUpdate=null,this.onZero=null,this.date=null,this.utc=null}}const n=[];var i=null;function a(){null==i&&(i=setInterval((()=>{const t=Date.now();n.forEach((e=>{e&&e.countDown(t)}))}),1e3))}function o(){n.length||(clearInterval(i),i=null)}window.logActiveTimers=()=>console.log(n);class l{constructor(t={}){this.setData(t),this.startTimer()}setData(t){this.date=new Date(t.date||this.date||Date.now()).getTime(),this.utc=t.utc||this.utc,this.onUpdate=t.onUpdate||this.onUpdate||function(){},this.onZero=t.onZero||this.onZero||function(){this.$stop()},this.interval=t.interval||this.interval||1e3}startTimer(){if(this.date-Date.now()<=0)return this.handleZero();this.start(),this.countDown(Date.now())}countDown(t){if(this.date-t<=0)return this.stop(),this.handleZero();var e=(this.date-t)/1e3,r=[86400,3600,60,1].map((t=>{var r=Math.max(Math.floor(e/t),0);return e-=t*r,r}));this.onUpdate(r,e)}handleZero(){this.onZero&&this.onZero()}start(){var t=n.indexOf(this);-1===t&&n.push(this),a()}stop(){var t=n.indexOf(this);-1!==t&&n.splice(t,1),o()}$update(t){this.setData(t),this.startTimer()}$destroy(){this.stop(),this.onUpdate=null,this.onZero=null,this.date=null,this.utc=null,console.log("Destroy",this,n)}}},3756:function(t,e,r){r.r(e),r.d(e,{default:function(){return Y}});var s=r(6252),n=r(3577);const i={class:"flex justify-center flex-wrap full-h relative",style:{height:"auto","max-width":"1700px",margin:"auto"}},a={key:1},o={style:{flex:"0 1 1200px"}},l={class:"side-article flex-fill"};function c(t,e,r,c,h,d){const u=(0,s.up)("PagePath"),m=(0,s.up)("PageTitle"),p=(0,s.up)("LoadingComponent"),g=(0,s.up)("MarkdownArticle"),f=(0,s.up)("ToC");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",null,[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(u),(0,s._)("h1",null,(0,n.zw)(h.title),1)])),_:1})]),(0,s._)("div",i,[h.isFetching?((0,s.wg)(),(0,s.j4)(p,{key:0})):h.fetchError?((0,s.wg)(),(0,s.iD)("div",a," Error ")):((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[(0,s._)("div",o,[(0,s.Wm)(g,{ref:"article",article:h.content,onReady:d.contentReady},null,8,["article","onReady"])]),(0,s._)("div",l,[(0,s.Wm)(f,{ref:"toc",target:()=>this.$refs.article?.$el},null,8,["target"])])],64))])],64)}var h=r(6004),d=r(222),u=r(6120);const m={class:"reading-progress"},p={ref:"reading_article_progress",class:"reading-progress-fill"};function g(t,e,r,n,i,a){const o=(0,s.up)("CKArticleContent");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",m,[(0,s._)("div",p,null,512)]),(0,s.Wm)(o,{class:"flex-fill article overflow-auto full-h",source:r.article,onReady:e[0]||(e[0]=e=>t.$emit("ready"))},null,8,["source"])])}const f=["innerHTML"];function v(t,e,r,n,i,a){return(0,s.wg)(),(0,s.iD)("div",{ref:"article",class:"ck-content",innerHTML:a.parsedText},null,8,f)}r(560);var w=r(7688),b=r(2229),_=r(8753);const y=["img","br","hr","vr"];function k(t,e,r){if(!t)return"";const s=y.includes(t)?"":`</${t}>`,n=e?Object.keys(e).map((t=>t+`="${e[t]}"`)).join(" ").trim():"";return r?Array.isArray(r)&&(r=r.join("")):r="",`<${t} ${n+(s?"":" /")}>`+r+s}function $(t,e,r){return[t,e,r]}const T=(t,e,r,s=$)=>{const n=r+"face/"+e.id,i=e.tags&&e.tags.includes(1),a=r+"img/cm_icon_prom"+e.attribute+".png",o=r+"img/cm_icon_role_"+e.role+".png",l=r+"img/cm_icon_zodiac_"+e.zodiac+".png",c=r+"img/cm_icon_star.png",h=r+"item/border/icon_border_base.png";return"icon"===t.type?s("span",{class:"hero icon noselect"},[s("img",{src:n+"_s.png",class:"absolute center"}),s("img",{src:h,class:"icon-border"}),s("span",{class:"role-attribute"},[s("img",{src:o}),s("img",{src:a})]),i?s("span",{class:"limited-ribbon"},[s("span",{},"Limited")]):null,t["show-name"]?s("span",{class:"label"},[s("span",{},e.name)]):null]):s("span",{class:"hero panel noselect"},[s("img",{src:n+"_l.png",class:"hero-icon noselect"}),s("span",{class:"top-row black-stroke noselect"},[s("img",{src:o}),s("span",{},e.name)]),s("span",{class:"bottom-row black-stroke noselect"},[s("img",{src:a}),s("img",{src:l}),...new Array(5).fill().map((()=>s("img",{src:c,class:"star"})))]),i?s("span",{class:"limited-ribbon"},[s("span",{},"Limited")]):null])},D=(t,e,r)=>r?t("span",{class:"limited-ribbon"},[t("span",{},"Limited")]):null;function C(t,e,r,s=$){const n=r+"item_arti/",i=e.tags&&e.tags.includes(1),a=!(!e.role||"common"===e.role),o=r+"img/cm_icon_role_"+e.role+".png",l=r+"img/cm_icon_star.png";return"icon"===t.type?s("span",{class:"artifact icon noselect"},[s("img",{src:n+"icon_"+e.id+".png",class:"icon"}),s("span",{class:"role-attribute"},a?[s("img",{src:o})]:null),t["show-name"]?s("span",{class:"label"},[s("span",{},e.name)]):null,D(s,r,i)]):"banner"===t.type?s("span",{class:"artifact banner noselect"},[s("img",{src:n+e.id+"_l.jpg",class:"thumbnail"}),s("img",{src:r+"item_arti/arti_frame_small.png",class:"frame"}),s("img",{src:n+"icon_"+e.id+".png",class:"icon"}),s("span",{class:"labels"},[s("span",{},a?[s("img",{src:o})]:null),s("span",{},[...new Array(5).fill().map((()=>s("img",{src:l,class:"star"})))]),s("span",{class:"black-stroke"},e.name)]),D(s,r,i)]):s("span",{class:"artifact full noselect"},[s("img",{src:n+e.id+"_fu.png",class:"image noselect"}),s("img",{src:r+"item_arti/arti_frame_deco_2.png",class:"bottom-frame"}),s("span",{class:"name black-stroke"},e.name),D(s,r,i)])}function x(t,e,r){return T(t,e,r,k)}function Z(t,e,r){return C(t,e,r,k)}function A(t,e){return`<span class="emote"><img src="${e+t.src}" alt="${t.alt}" title="${t.alt}" /></span>`}function E(t){var e,r={};const s=/ *([^=\s]+)="([^"]*)"/g;while(e=s.exec(t)){if(!e)break;r[e[1]]=e[2]}return r["show-name"]="true"==r["show-name"],r}var I={name:"ArticleParser",emits:["ready"],props:{source:{type:String,default:""}},data(){return{tableObserver:null,markdownClocks:[]}},beforeCreate(){},beforeUnmount(){this.markdownClocks.forEach((t=>{t.$destroy()})),this.markdownClocks=[]},watch:{parsedText:{immediate:!0,handler(){this.$el&&this.$el.querySelectorAll("[data-src]").forEach((t=>{b.cD.unobserve(t),t.onclick=null})),this.$nextTick((()=>{this.$el.querySelectorAll("[data-src]").forEach((t=>{b.cD.observe(t)})),this.$el.querySelectorAll("figure > img").forEach((t=>{t.classList.add("pointer"),t.onclick=()=>{window.$gallery([{src:t.getAttribute("data-src")||t.getAttribute("src"),name:t.getAttribute("title")||t.getAttribute("alt"),description:""}])}}))})),this.markdownClocks.forEach((t=>{t.$destroy()})),this.markdownClocks=[],this.$nextTick((()=>{this.$el.querySelectorAll("[data-time]").forEach((t=>{var e=t.getAttribute("data-time");this.markdownClocks.push(new w.Z({date:e?new Date(e).getTime():void 0,interval:1e3,onUpdate:(r,s)=>{t.innerHTML=e?this.localizeTime.map(((t,e)=>void 0===r[e]?"":r[e]+t)).join(" "):s},onZero(){t.innerHTML="⏱️ Expired",this.$destroy()}}))}))})),this.$emit("ready")}}},computed:{parsedText(){const t=t=>({name:t,id:"c1002",_id:t,role:"warrior",attribute:"fire",rarity:5,zodiac:"goat",tags:[]}),e=t=>({name:t,id:"art0001",_id:t,role:"warrior",rarity:5,tags:[]});let r=this.source.replace(/<hero([^>]*)>(.*?)<\/hero>/g,(function(e,r){let s=E(r);return`<a href="/#/hero/${s._id}" >${x(s,t(s._id),_.cK)}</a>`})).replace(/<artifact([^>]*)>(.*?)<\/artifact>/g,(function(t,r){let s=E(r);return`<a href="/#/artifacts/${s._id}" >${Z(s,e(s._id),_.cK)}</a>`})).replace(/<span([^>]+class="emote"[^>]*)>(.*?)<\/span>/g,(function(t,e){let r=E(e);return A(r,_.cK)})).replace(/\ssrc\s*=/g," data-src=").trim();return r},localizeTime(){return this.$tm("strings.Dhms")}}},U=r(3744);const L=(0,U.Z)(I,[["render",v]]);var M=L,P={name:"ArticleReaderWrapper",emits:["ready"],components:{CKArticleContent:M},props:{article:{type:String,default:""}},methods:{updateReadingProgress(){var t=document.getElementById("app_content").parentNode;let e=window.innerHeight;this.$refs.reading_article_progress.style.setProperty("width",t.scrollTop/(t.scrollHeight-e)*100+"%")}},mounted(){document.getElementById("app_content").parentNode.addEventListener("scroll",this.updateReadingProgress)},beforeUnmount(){document.getElementById("app_content").parentNode.removeEventListener("scroll",this.updateReadingProgress)}};const H=(0,U.Z)(P,[["render",g]]);var R=H,S=r(9963);const N={class:"table-of-contents"},O={ref:"positionIndicator",class:"line"},j=["id"];function q(t,e,r,i,a,o){const l=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",N,[(0,s._)("div",O,null,512),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.headings,(t=>((0,s.wg)(),(0,s.j4)(l,{key:t.selfId,to:{hash:"#"+t.headingId},onClick:(0,S.iM)((e=>o.scrollToElement(t.el)),["prevent"])},{default:(0,s.w5)((()=>[(0,s._)("div",{id:t.selfId,class:(0,n.C_)(["toc-item text-ellipsis",t.class])},(0,n.zw)(t.title),11,j)])),_:2},1032,["to","onClick"])))),128))])}var z={expose:["refresh"],props:{target:{type:Function,default:()=>null}},data(){return{observer:null,headings:[]}},created(){this.observer=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting){let e=t.target;if(t.intersectionRatio>=.75){let t=this.$el.querySelector(".active-toc");t&&t.classList.remove("active-toc");let r=this.$el.querySelector("#"+e.getAttribute("data-toc-id"));r&&(this.$refs.positionIndicator.style.top=2*([...r.parentElement.parentElement.children].indexOf(r.parentElement)-1)+"em",r.classList.add("active-toc"))}}}))}),{rootMargin:"0px",threshold:1})},mounted(){this.$nextTick((()=>this.generateTableOfContents()))},beforeUnmount(){this.observer.disconnect(),this.observer=null},methods:{scrollToElement(t){t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},refresh(){this.observer.disconnect(),this.generateTableOfContents()},generateTableOfContents(){let t=this.target();const e=this.prefix;t&&(this.headings=[].slice.call(t.querySelectorAll("h1, h2, h3, h4, h5, h6")).map(((t,r)=>{const s=e+"-toc-"+r,n=e+"-"+r;return t.setAttribute("data-toc-id",s),this.observer.observe(t),{class:t.tagName.toLowerCase(),title:t.textContent,selfId:s,headingId:n,el:t}})).filter((t=>!!t)))}}};const K=(0,U.Z)(z,[["render",q]]);var W=K,F={name:"GuidesReader",components:{LoadingComponent:u.Z,PagePath:h.Z,PageTitle:d.Z,MarkdownArticle:R,ToC:W},props:{heroProp:{}},data(){return{isFetching:!0,fetchError:!1,articleId:this.$route.params.id,author:"",readTime:1,title:"Loading...",content:""}},created(){if(this.heroProp)return this.author="",this.title="Preview",void(this.content=this.heroProp);this.$gameData.guides.get(this.$route.params.id).then((t=>{this.author=t.author,this.title=t.title,this.content=t.content})).catch((t=>{console.error(t),this.fetchError=!0})).then((()=>{this.isFetching=!1}))},methods:{contentReady(){this.$nextTick((()=>{this.$refs.toc.refresh()}))}}};const B=(0,U.Z)(F,[["render",c]]);var Y=B}}]);